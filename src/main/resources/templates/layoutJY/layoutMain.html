<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
<link rel="stylesheet" th:href="@{/css/ja0/header.css}" />
<link rel="stylesheet" th:href="@{/css/ja0/sideMenu.css}" />
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<style>
.body {
	width: 1000px;
}

.my_manu div img {
	margin: 10px;
}

#myProfile {
	text-align: center;
	padding: 10px;
}

#myProfile img{
	width: 100px;
	height: 100px;
}

#myName, #userName {
	font-weight: bold;
	font-size: 17px;
}

#myModal {
	position: fixed;
	top: 30%;
	left: 20%;
	right: 20%;
}

img#status {
	width: 20px;
	height: 20px;
}

.userProfile .img{
	width: 40px;
	height: 40px;
}

#listTitle {
	padding-left: 15px;
}

.userProfile {
	position: relative;
}

.admin {
	width: 15px;
	height: 15px;
	position: absolute;
	left: 10%;
    top: -15%;
}

.statusBtn {
	font-size: 14px;
}

#proList {
	height: 60%;
	overflow-x: hidden;
	overflow-y: auto;
}

/* 스크롤바 설정*/
#proList::-webkit-scrollbar{
    width: 5px;
}

/* 스크롤바 막대 설정*/
#proList::-webkit-scrollbar-thumb{
    height: 10%;
    background-color: rgba(0,0,0,0);
    border-radius: 10px;/* 스크롤바 둥글게 설정    */
}

/* 스크롤바 hover*/
#proList:hover::-webkit-scrollbar-thumb{
    background-color: #858585;
}

/* 스크롤바 뒷 배경 설정*/
#proList::-webkit-scrollbar-track{
    background-color: rgba(0,0,0,0);
}

.green, .red {
	font-size: 20px;
	position: absolute;
	left: 15%;
    top: 50%;
}

.green {
	color: green;
}

.red {
	color: red;
}

#userInfo {
	position: absolute;
	display: none;
    top: 0px;
    left: 0px;
    width: 97%;
	border: 2.5px solid #FF7F27;
	background-color: white;
	border-radius: 0.5em;
	padding: 10px 0px;
	z-index: 1;
}

#userInfo img{
    width: 50px;
    height: 50px;
}

#userInfo img, #uInfo {
	float: left;
}

.userProfile:hover #userInfo {
	display: flex;
    align-items: center;
	opacity: 1;
}

</style>

<th:block layout:fragment="style"></th:block>
</head>

<body>
<header th:replace="~{/layoutJY/header::header1}"></header>

<div id="cont">
	<div id="side">
		<div th:replace="~{/layoutJY/side :: side}"></div>
			
		<div class="my_manu">
			<div id="myProfile">
				<img th:if="${session.user.image == null}" th:src="@{/images/userImg.svg}" class="img-circle">
				<img th:if="${session.user.image != null}" th:src="${session.user.image}" class="img-circle">
				<div id="myInfo">
					<div id="myName">[[${session.user.name}]]
						<button th:if="${session.user.status != null}" class="btn btn-default btn-sm statusBtn" data-toggle="modal" data-target="#myModal">[[${session.user.status}]]</button>
						<button th:if="${session.user.status == null}" class="btn btn-default btn-sm statusBtn" data-toggle="modal" data-target="#myModal">퇴근</button>
					</div>
					[[${session.user.company}]]
				</div>
			</div>
			
			<hr>
			
			<h4 id="listTitle">팀원</h4>
			<div id="proList">
				<div class="userProfile" th:each="tu:${userList}" th:if="${tu.teamUserId.user.userId != session.user.userId}">
					<img th:if="${tu.teamUserId.user.image == null}" th:src="@{/images/userImg.svg}" class="img-circle img">
					<img th:if="${tu.teamUserId.user.image != null}" th:src="${tu.teamUserId.user.image}" class="img-circle img">
					
					<img class="admin" th:if="${tu.userRole == 'ADMIN'}" th:src="@{/images/crown.svg}">
					<p class="status green" th:if="${tu.teamUserId.user.status == '출근'}">●</p>
					<p class="status red" th:if="${tu.teamUserId.user.status != '출근'}">●</p>
					
					[[${tu.teamUserId.user.name}]]
					
					<div id="userInfo">
						<img th:if="${tu.teamUserId.user.image == null}" th:src="@{/images/userImg.svg}" class="img-circle img">
						<img th:if="${tu.teamUserId.user.image != null}" th:src="${tu.teamUserId.user.image}" class="img-circle img">
						
						<div id="uInfo">
							<p id="userName">[[${tu.teamUserId.user.name}]] ( [[${tu.teamUserId.user.company}]] )<p>
							<p>[[${tu.teamUserId.user.status}]]</p>
						</div>
					</div>
				</div>
			</div>
		</div>
			
		<!-- 상태변경 모달 -->
	    <div id="myModal" class="modal fade" role="dialog">
			<div class="model_dialog">
		        <!-- Modal content -->
		        <div class="modal-content">
		        	<div class="modal-body">
						<label>상태변경</label> 
						<select class="form-control" name="status">
							<option>출근</option>
							<option>회의중</option>
							<option>자리비움</option>
							<option>외근</option>
							<option>퇴근</option>
							<option>휴가</option>
						</select>
			        </div>
					<div class="modal-footer">
				    	<button id = "statusUpdate" class="btn btn-cococo">수정</button>
				    	<button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
		        	</div>
		        </div>
	    	</div>
	    </div> <!-- Modal --> 
	    
		<!-- 하위 HTML에서 content 재정의할 예정 -->
		<div layout:fragment="content"></div>
	</div>
</div>

<script>
$(".statusBtn").click(function () {
	var status = "[[${session.user.status}]]";
	
	if(status != null || status != '') {
		$("select[name='status']").val(status);
		return;
	}
	alert("null!");
})

$("#statusUpdate").click(function () {
	var status = $("select[name='status']").val();

	location.href="/main/updateStatus/" + status + "/[[${team.teamId}]]";
})
</script>

<th:block layout:fragment="script"></th:block>
</body>
</html>