<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<!--//ajax csrf//-->
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<link rel="stylesheet" th:href="@{/css/login.css}" />
<head>
<style>
#userId {
	width: 422px;
}

/* 아이디 중복체크 */
.idCheck {
	margin: 0;
	padding: 0;
	width: 60px;
	height: 52px;
}
</style>
<script>
	$(function() {
		$("#pw").on("keyup", checkPW);
		$("#pw2").on("keyup", checkPW);
		$("#btn").click(final_Check);
	});

	function final_Check() {
		var id = $(".id_input").val(); // id 입력란
		var pw1 = $(".pw_input").val(); // pw 입력란
		var pw2 = $(".pw2_input").val(); // pw 확인 입력란
		var name = $(".name_input").val(); // 이름 입력란
		var idCheck = $("#idCheckBtn").val();

			/* 아이디 유효성검사 */
			if (id.length == 0 || id == '') {
			alert("아이디를 입력하세요")

			} else if (idCheck == "N") {
			alert("이미 사용중인 아이디 입니다.")
			
			/* 이름 유효성검사 */
			} else if (name.length == 0 || name == '') {
			alert("이름을 입력하세요")
			
			/* 비밀번호 유효성검사 */
			} else if (pw.length == 0 || pw == '') {
			alert("비밀번호를 입력하세요")
			
			/* 비밀번호 확인 유효성검사 */
			} else if (pw2.length == 0 || pw2 == '') {
			alert("비밀번호를 확인하세요")
			
			} else {
			$("#btn").attr('type', 'submit');
			} 
		
	}

	/* 비밀번호 확인 */
	function checkPW() {
		var pw1 = $("#pw").val();
		var pw2 = $("#pw2").val();

		if (pw1 == pw2) {

			if (pw1.length == 0 || pw1 == '') {
				$("#btn").css('background-color', '#f0f0f0')
			} else {
				$("#btn").css('background-color', '#9acd32')
			}
		} else {
			$("#btn").css('background-color', '#ff6347')
		}
	}

	/* 아이디 중복확인 */
	function idCheckFunc() {
		//ajax csrf//		
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");

		$.ajax({
			url : '/auth/idCheck', //Controller에서 인식할 주소
			type : 'post', //POST 방식으로 전달
			data : {
				"userId" : $("#userId").val()
			},

			//ajax csrf//
			beforeSend : function(xhr) { /*데이터를 전송하기 전에 헤더에 csrf값을 설정한다*/
				xhr.setRequestHeader(header, token);
			},

			success : function(data) {
				if (data == 1) {
					alert("이미 사용중인 아이디 입니다.")
					$("#idCheckBtn").attr("value", "N")
					console.log("N")
					
				} else if (data == 0) {
					$("#idCheckBtn").attr("value", "Y");
					alert("사용 가능한 아이디 입니다.");
					console.log("Y")
				}

			}
		})
	}
</script>

<style>
body {
	text-align: center;
}

.join_section {
	padding: 145px 0px 200px;
}

.join {
	margin-bottom: 20px;
}

button {
	width: 486px;
	height: 52px;
	margin-top: 20px;
}

input {
	width: 486px;
	height: 52px;
	padding-left: 20px;
}
</style>
<title>회원가입 페이지</title>
<meta charset="utf-8" />
</head>
<body>
	<div class="join_section">
		<div class="panel-body">

			<h2 class="join">회원가입</h2>
			<form method="post" action="joinProc">
				<p>
					<label for="userId"></label> <input type="text" id="userId"
						class="id_input" name="userId" placeholder="아이디">
					<button id="idCheckBtn" type="button" class="idCheck btn-outline-cococo"
						onclick="idCheckFunc();" value="N">중복확인</button>
				</p>
				
				<p>
					<label for="company"></label> <input type="text" id="company"
					class="company" name="company" placeholder="소속" />				
				</p>

				<p>
					<label for="name"></label> <input type="text" id="name"
						class="name_input" name="name" placeholder="이름" />
				</p>

				<p>
					<label for="pw"></label> <input type="password" id="pw"
						class="pw_input" name="pw" placeholder="비밀번호" />
				</p>

				<p>
					<label for="pw2"></label> <input type="password" class="pw2_input"
						id="pw2" name="pw2" placeholder="비밀번호 확인" />
				</p>
				<input type="hidden" th:name="${_csrf.parameterName}"
					th:value="${_csrf.token}" />
				<button id="btn " type="button" class="join_btn btn-cococo" value="N">가입</button>
			</form>

		</div>
	</div>
	<!-- join_section -->
</body>
</html>