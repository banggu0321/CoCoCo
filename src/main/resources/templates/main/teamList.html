<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/layoutJY/layoutTeamList.html}">
<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>

<link rel="stylesheet" th:href="@{/css/ja0/teamListcss.css}" />

<title>CoCoCo</title>
<style>

</style>
</head>
<body>
<div layout:fragment="content">
	<div id="mainTitle">
		<button data-toggle="modal" data-target="#myModal2" class="btn btn-cococo inviteBtn">초대코드</button>
		<h3 id="title">WORKSPACE LIST</h3>
	</div>
	<div class="content" th:each="team:${teamList}">
		<div class="box" th:team-data="${team.teamUserId.team.teamId}">
			<img th:src="@{/images/deleteImg.svg}" class="delBtn" th:team-data="${team.teamUserId.team.teamId}">
			<img th:if="${team.teamUserId.team.teamImg!=null}" th:src="${team.teamUserId.team.teamImg}" th:alt="${team.teamUserId.team.teamImg}" class="img-rounded">
			<img th:if="${team.teamUserId.team.teamImg==null}" th:src="@{/images/teamImg.png}" alt="null" class="img-rounded">
			<p class="name">[[${team.teamUserId.team.teamName}]]</p>
			<p>[[${#dates.format(team.teamUserId.team.createDate,'yyyy-MM-dd')}]]</p>
			<p class="info">[[${team.teamUserId.team.teamInfo}]]</p>	
		</div>
	</div>
	<div class="addTeam" data-toggle="modal" data-target="#myModal">+</div>
	
	<!-- 워크스페이스 등록 모달 -->
    <div id="myModal" class="modal fade" role="dialog">
		<div class="model_dialog">
	        <!-- Modal content -->
	        <div class="modal-content">
	        	<div class="modal-header">
	           		<h4 class="modal-title">NEW WORKSPACE</h4>
	       		</div>
	       		
	        	<div class="modal-body modalBody1">
	        		<img th:src="@{/images/teamImg.png}" class="showImg img-rounded">
	        		
	        		<form id="addTeamForm" method="post" enctype="multipart/form-data">
			        	<label>WORKSPACE NAME</label>
			        	<input type="text" name="teamName" class="form-control">
			        	
			         	<label>WORKSPACE INFO</label>
			         	<textarea class="form-control body1" name="teamInfo" rows="2"></textarea>
						
						<div>
							<label>WORKSPACE IMG</label> 
							<input type="file" name="teamPhoto" id="img" class="form-control custom-file-input">
						</div>
						
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
		        	</form>
		        </div>
			
				<div class="modal-footer">
			    	<button id = "addTeamBtn" class="btn btn-cococo">워크스페이스 만들기</button>
			    	<button type="button" class="btn btn-default valDel" data-dismiss="modal" >취소</button>
	        	</div>
	        </div>
    	</div>
    </div> <!-- Modal --> 
    
	<!-- 초대코드 입력 모달 -->
    <div id="myModal2" class="modal fade" role="dialog">
		<div class="model_dialog">
	        <!-- Modal content -->
	        <div class="modal-content">
	        	<div class="modal-body">
					<label>초대코드 입력</label> 
					<input type="text" id="code" class="form-control">
		        </div>
				<div class="modal-footer">
			    	<button id = "enterBtn" class="btn btn-cococo">워크스페이스 입장</button>
			    	<button type="button" class="btn btn-default valDel" data-dismiss="modal">취소</button>
	        	</div>
	        </div>
    	</div>
    </div> <!-- Modal --> 
    
</div>

<th:block layout:fragment="script">
	<script>
	$(function() {
		var msg = "[[${msg}]]";
		if(msg != "") {
			alert(msg);
		}
		
	 	$(".box").click(goTeamMain);
	 	$("#enterBtn").click(enterTeam);
	 	$(".delBtn").click(deleteTeam);
	 	$("#addTeamBtn").click(addTeam);
	 	$("#img").change(makeView);
	 	$(".valDel").click(valueDelete);
	})
	
	var token = $("meta[name='_csrf']").attr("content");
	var header = $("meta[name='_csrf_header']").attr("content");
	
	function goTeamMain() {
		var teamId = $(this).attr("team-data");
		location.href="/main/"+teamId;
	}
		
	function enterTeam() {
		var code = $("#code").val();
			
		$.ajax({
			type:"post",
			url:"/main/findTeam/"+code,
			beforeSend : function(xhr){
				xhr.setRequestHeader(header, token);
			},
			success: function(resData) {
				if(resData != 0) {
					location.href = "/main/"+resData;
					return;
				}
				alert("초대코드를 확인해주세요!");
			}
		});
	}
		
	function deleteTeam(e) {
		e.stopPropagation();
		var teamId = $(this).attr("team-data");
		if(confirm("해당 워크스페이스를 삭제하시겠습니까?")) {
			location.href = "/main/deleteTeam/"+teamId;
		}
	}
		
	function addTeam() {
		var addForm = $("#addTeamForm");
		addForm.attr("action","/main/addTeam");
		addForm.submit();
	}
		
	function makeView(event) {
		var reader = new FileReader();

		reader.onload = function(event) {
			$(".showImg").attr("src", event.target.result);
		};

		reader.readAsDataURL(event.target.files[0]);
	}
		
	function valueDelete() {
		$("input").val("");
		$("textarea").val("");
		$(".showImg").attr("src", "/images/teamImg.png");
	}
	</script>
</th:block>
</body>
</html>