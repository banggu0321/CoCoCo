<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<link rel="stylesheet" th:href="@{/css/ja0/header.css}" />
<link rel="stylesheet" th:href="@{/css/ja0/sideMenu.css}" />
<link rel="stylesheet" th:href="@{/css/ja0/layoutMaincss.css}" />

<th:block layout:fragment="style"></th:block>
</head>

<body>
<header th:replace="~{/layoutJY/header::header1}"></header>

<div id="cont">
	<div id="side">
		<div th:replace="~{/layoutJY/side :: side}"></div>
			
		<div class="my_manu">
			<div id="myProfile">
				<img th:if="${session.user.image == null}" th:src="@{/images/userImg.svg}" class="img-circle">
				<img th:if="${session.user.image != null}" th:src="${session.user.image}" class="img-circle">
				<div id="myInfo">
					<div id="myName">[[${session.user.name}]]
						<button th:if="${session.user.status != null}" class="btn btn-default btn-sm statusBtn" data-toggle="modal" data-target="#myModal">[[${session.user.status}]]</button>
						<button th:if="${session.user.status == null}" class="btn btn-default btn-sm statusBtn" data-toggle="modal" data-target="#myModal">퇴근</button>
					</div>
					[[${session.user.company}]]
				</div>
			</div>
			
			<hr>
			
			<h4 id="listTitle">팀원</h4>
			<div id="proList">
				<div class="userProfile" th:each="tu:${userList}" th:if="${tu.teamUserId.user.userId != session.user.userId}">
					<img th:if="${tu.teamUserId.user.image == null}" th:src="@{/images/userImg.svg}" class="img-circle img">
					<img th:if="${tu.teamUserId.user.image != null}" th:src="${tu.teamUserId.user.image}" class="img-circle img">
					
					<img class="admin" th:if="${tu.userRole == 'ADMIN'}" th:src="@{/images/crown.svg}">
					<p class="status green" th:if="${tu.teamUserId.user.status == '출근'}">●</p>
					<p class="status red" th:if="${tu.teamUserId.user.status != '출근'}">●</p>
					
					[[${tu.teamUserId.user.name}]]
					
					<div id="userInfo">
						<img th:if="${tu.teamUserId.user.image == null}" th:src="@{/images/userImg.svg}" class="img-circle img">
						<img th:if="${tu.teamUserId.user.image != null}" th:src="${tu.teamUserId.user.image}" class="img-circle img">
						
						<div id="uInfo">
							<p id="userName">[[${tu.teamUserId.user.name}]] ( [[${tu.teamUserId.user.company}]] )<p>
							<p>[[${tu.teamUserId.user.status}]]</p>
						</div>
					</div>
				</div>
			</div>
		</div>
			
		<!-- 상태변경 모달 -->
	    <div id="myModal" class="modal fade" role="dialog">
			<div class="model_dialog">
		        <!-- Modal content -->
		        <div class="modal-content">
		        	<div class="modal-body">
						<label>상태변경</label> 
						<select class="form-control" name="status">
							<option>출근</option>
							<option>회의중</option>
							<option>자리비움</option>
							<option>외근</option>
							<option>퇴근</option>
							<option>휴가</option>
						</select>
			        </div>
					<div class="modal-footer">
				    	<button id = "statusUpdate" class="btn btn-cococo">수정</button>
				    	<button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
		        	</div>
		        </div>
	    	</div>
	    </div> <!-- Modal --> 
	    
		<!-- 하위 HTML에서 content 재정의할 예정 -->
		<div layout:fragment="content"></div>
		
		<div id="main4">
			채팅!
		</div>
	</div>
</div>

<script>
$(function() {
	$(".statusBtn").click(myStatus);
	$("#statusUpdate").click(updateStatus);
})

function myStatus() {
	var status = "[[${session.user.status}]]";
	
	if(status != "") {
		$("select[name='status']").val(status);
		return;
	}
}

function updateStatus() {
	var status = $("select[name='status']").val();

	location.href="/main/updateStatus/t/" + status;
}
</script>

<th:block layout:fragment="script"></th:block>
</body>
</html>