<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/layoutJY/layoutTeamList.html}">
<head>
<meta charset="UTF-8">
<meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
<title>Insert title here</title>
<style>
.box, .addTeam {
	position: relative;
	float: left;
	width: 250px;
	height: 320px;
	text-align: center;
	padding: 30px 20px;
	margin: 20px;
	background-color: #eee;
	border-radius: 1em;
	cursor: pointer;
}

.box:hover, .addTeam:hover {
	background-color: rgba(255, 127, 39, 0.2);
	border: none;
}

.info {
	white-space: pre-wrap;
}

.name {
	font-size: 18px;
	font-weight: bold;
	padding-top: 10px;
}

.addTeam {
	font-size: 35px;
	background-color: white;
	border: 2px solid #FF7F27;
	border-radius: 0.5em;
	padding: 130px 10px;
}

.box img{
	width: 150px;
	height: 150px;
}
.box .delBtn {
	position: absolute;
	top: 85%;
	left: 85%;
	width: 30px;
	height: 30px;
}

.inviteBtn {
	float: right;
}

#title {
	float: left;
}

#myModal, #myModal2 {
	position: fixed;
	top: 30%;
	left: 20%;
	right: 20%;
}

hr {
	clear: both;
}
</style>
</head>
<body>
<div layout:fragment="content">
	<h1 id="title">프로젝트 리스트</h1>
	<button data-toggle="modal" data-target="#myModal2" class="btn btn-primary inviteBtn">초대코드</button>
	<hr>
	<div class="content" th:each="team:${teamList}">
		<div class="box" th:team-data="${team.teamUserId.team.teamId}">
			<img th:src="@{/images/deleteImg.svg}" class="delBtn" th:team-data="${team.teamUserId.team.teamId}">
			<img th:if="${team.teamUserId.team.teamImg!=null}" th:src="${team.teamUserId.team.teamImg}" th:alt="${team.teamUserId.team.teamImg}" class="img-rounded">
			<img th:if="${team.teamUserId.team.teamImg==null}" th:src="@{/images/teamImg.png}" alt="null" class="img-rounded">
			<p class="name">[[${team.teamUserId.team.teamName}]]</p>
			<p>[[${#dates.format(team.teamUserId.team.createDate,'yyyy-MM-dd')}]]</p>
			<p class="info">[[${team.teamUserId.team.teamInfo}]]</p>	
		</div>
	</div>
	<div class="addTeam" data-toggle="modal" data-target="#myModal">+</div>
	
	<!-- 워크스페이스 등록 모달 -->
    <div id="myModal" class="modal fade" role="dialog">
		<div class="model_dialog">
	        <!-- Modal content -->
	        <div class="modal-content">
	        	<div class="modal-header">
	           		<h4 class="modal-title">NEW WORKSPACE</h4>
	       		</div>
	       		
	        	<div class="modal-body">
	        		<form id="addTeamForm" method="post" enctype="multipart/form-data">
			        	<label>WORKSPACE NAME</label>
			        	<input type="text" name="teamName" class="form-control">
			        	
			         	<label>WORKSPACE INFO</label>
			         	<textarea class="form-control" name="teamInfo" rows="2"></textarea>
						
						<div>
							<label>WORKSPACE IMG</label> 
							<input type="file" name="teamPhoto" class="form-control custom-file-input">
						</div>
						
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
		        	</form>
		        </div>
			
				<div class="modal-footer">
			    	<button id = "addTeamBtn" class="btn btn-primary">워크스페이스 만들기</button>
			    	<button type="button" class="btn btn-primary" data-dismiss="modal" >취소</button>
	        	</div>
	        </div>
    	</div>
    </div> <!-- Modal --> 
    
	<!-- 초대코드 입력 모달 -->
    <div id="myModal2" class="modal fade" role="dialog">
		<div class="model_dialog">
	        <!-- Modal content -->
	        <div class="modal-content">
	        	<div class="modal-body">
					<label>초대코드 입력</label> 
					<input type="text" id="code" class="form-control">
		        </div>
				<div class="modal-footer">
			    	<button id = "enterBtn" class="btn btn-primary">워크스페이스 입장</button>
			    	<button type="button" class="btn btn-primary" data-dismiss="modal" >취소</button>
	        	</div>
	        </div>
    	</div>
    </div> <!-- Modal --> 
    
</div>

<th:block layout:fragment="script">
	<script>
		var token = $("meta[name='_csrf']").attr("content");
	 	var header = $("meta[name='_csrf_header']").attr("content");
	
		$(".box").click(function() {
			var teamId = $(this).attr("team-data");
			location.href="/main/"+teamId;
		});
		
		$("#enterBtn").click(function() {
			var code = $("#code").val();
			
			$.ajax({
				type:"post",
				url:"/main/findTeam/[[${session.user.userId}]]/"+code,
				beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				},
				success: function(resData) {
					if(resData != 0) {
						location.href = "/main/"+resData;
						return;
					}
					alert("초대코드를 확인해주세요!");
				}
			});
		});
		
		$(".delBtn").click(function(e) {
			e.stopPropagation();
			var teamId = $(this).attr("team-data");
			if(confirm("해당 워크스페이스를 삭제하시겠습니까?")) {
				location.href = "/main/deleteTeam/[[${session.user.userId}]]/"+teamId;
			}
		});
		
		$("#addTeamBtn").click(function() {
			var addForm = $("#addTeamForm");
			addForm.attr("action","/main/addTeam/[[${session.user.userId}]]");
			addForm.submit();
		});
	</script>
</th:block>
</body>
</html>